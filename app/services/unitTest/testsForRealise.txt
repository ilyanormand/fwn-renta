1. Happy Path (Базовые успешные сценарии)
Должен корректно рассчитать CMP для одного товара
Должен обработать несколько товаров за раз
Должен учитывать shipping fee в расчете
2. Edge Cases (Граничные случаи)
Когда oldStock = 0 → CMP = новая цена
Когда oldCmp = null → CMP = новая цена
Когда новая цена = старой цене → CMP не изменяется
Когда qty = 0 → должен корректно обработать
Когда oldStock = 0 и oldCmp = 0 → CMP = новая цена
3. Error Handling (Обработка ошибок)
Когда Google Sheets возвращает null/undefined
Когда SKU не найден в таблице
Когда Shopify API недоступен
Когда несколько товаров, часть найдена, часть нет
4. Data Validation (Валидация данных)
Должен нормализовать SKU (ICE-LEMON = ice-lemon)
Должен обработать несколько SKU в одной ячейке (разделенные через /,;|)
Должен корректно обновить правильную строку в Sheets
5. Integration (Интеграционные проверки)
Должен вызвать readData с правильными параметрами
Должен вызвать updateData с правильным диапазоном
Должен вызвать getInventoryBySku для каждого товара